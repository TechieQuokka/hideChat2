<Window x:Class="hideChat2.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Alpha"
        Height="600"
        Width="500"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen"
        Background="#EEF2F7">

    <Grid>
        <!-- Bootstrap Overlay (Tor 시작 중) -->
        <Grid x:Name="BootstrapOverlay" Visibility="Visible" Background="#EEF2F7">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Margin="20">
                <!-- Port Configuration (before start) -->
                <Border x:Name="PortConfigPanel" Background="White" CornerRadius="8" Padding="20" Margin="0,0,0,20"
                        BorderBrush="#D0D7DE" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="포트 설정"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="#4A5568"
                                   Margin="0,0,0,10"/>

                        <TextBlock Text="베이스 포트:"
                                   FontSize="12"
                                   Foreground="#666666"
                                   Margin="0,0,0,5"/>

                        <TextBox x:Name="BasePortTextBox"
                                 Text="9050"
                                 FontFamily="Consolas"
                                 FontSize="14"
                                 Padding="8"
                                 Margin="0,0,0,10"
                                 MaxLength="5"/>

                        <TextBlock Text="사용 포트: SOCKS(9050), Control(9051), Service(9052)"
                                   FontSize="10"
                                   Foreground="#888888"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,15"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button x:Name="StartTorButton"
                                    Content="Tor 시작"
                                    Padding="20,10"
                                    Margin="0,0,10,0"
                                    Click="StartTorButton_Click"
                                    FontSize="14"
                                    FontWeight="Bold"/>

                            <Button x:Name="CleanStartButton"
                                    Content="새로 시작"
                                    Padding="20,10"
                                    Click="CleanStartButton_Click"
                                    FontSize="14"
                                    ToolTip="이전 데이터 삭제 후 시작"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Progress Panel (during bootstrap) -->
                <StackPanel x:Name="BootstrapProgressPanel" Visibility="Collapsed">
                    <TextBlock x:Name="BootstrapTitle"
                               Text="Tor 네트워크 연결 중"
                               FontSize="20"
                               FontWeight="Bold"
                               Foreground="#4A5568"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10"/>

                    <TextBlock x:Name="BootstrapPortInfo"
                               Text="포트: 9050 (SOCKS: 9050, Control: 9051, Service: 9052)"
                               FontFamily="Consolas"
                               FontSize="10"
                               Foreground="#666666"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,20"/>

                    <ProgressBar x:Name="BootstrapProgressBar"
                                 Width="300"
                                 Height="20"
                                 Minimum="0"
                                 Maximum="100"
                                 Value="0"
                                 Margin="0,0,0,10"/>

                    <TextBlock x:Name="BootstrapStatus"
                               Text="시작 중..."
                               FontSize="12"
                               Foreground="#666666"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,5"/>

                    <TextBlock Text="예상 시간: 30-60초"
                               FontSize="11"
                               Foreground="#888888"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Waiting Overlay (연결 대기) -->
        <Grid x:Name="WaitingOverlay" Visibility="Collapsed" Background="#EEF2F7">
            <StackPanel VerticalAlignment="Center" Margin="20">
                <!-- Current Port Info -->
                <Border Background="White"
                        CornerRadius="5"
                        BorderBrush="#D0D7DE"
                        BorderThickness="1"
                        Padding="10"
                        Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="현재 포트"
                                       FontSize="11"
                                       Foreground="#666666"
                                       Margin="0,0,0,3"/>
                            <TextBlock x:Name="CurrentPortTextBlock"
                                       Text="베이스: 9050 (SOCKS: 9050, Control: 9051, Service: 9052)"
                                       FontFamily="Consolas"
                                       FontSize="10"
                                       Foreground="#4A5568"/>
                        </StackPanel>

                        <Button x:Name="ChangePortButton"
                                Grid.Column="1"
                                Content="변경"
                                Padding="10,5"
                                Margin="5,0,0,0"
                                Click="ChangePortButton_Click"/>
                    </Grid>
                </Border>

                <TextBlock Text="내 주소:"
                           FontSize="14"
                           Foreground="#4A5568"
                           Margin="0,0,0,5"/>

                <Border Background="White"
                        CornerRadius="5"
                        BorderBrush="#D0D7DE"
                        BorderThickness="1"
                        Padding="10"
                        Margin="0,0,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="MyAddressTextBox"
                                 Grid.Column="0"
                                 IsReadOnly="True"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 FontFamily="Consolas"
                                 FontSize="10"
                                 VerticalAlignment="Center"
                                 TextWrapping="Wrap"/>

                        <Button x:Name="CopyAddressButton"
                                Grid.Column="1"
                                Content="복사"
                                Padding="10,5"
                                Margin="5,0,0,0"
                                Click="CopyAddressButton_Click"/>
                    </Grid>
                </Border>

                <TextBlock Text="상대방 주소:"
                           FontSize="14"
                           Foreground="#4A5568"
                           Margin="0,20,0,5"/>

                <Border Background="White"
                        CornerRadius="5"
                        BorderBrush="#D0D7DE"
                        BorderThickness="1"
                        Padding="10"
                        Margin="0,0,0,10">
                    <TextBox x:Name="PeerAddressTextBox"
                             BorderThickness="0"
                             Background="Transparent"
                             FontFamily="Consolas"
                             FontSize="10"
                             KeyDown="PeerAddressTextBox_KeyDown"/>
                </Border>

                <Button x:Name="ConnectButton"
                        Content="연결"
                        Padding="20,10"
                        HorizontalAlignment="Center"
                        Click="ConnectButton_Click"
                        Margin="0,0,0,10"/>

                <TextBlock x:Name="StatusTextBlock"
                           Text="상태: 대기 중..."
                           FontSize="12"
                           Foreground="#666666"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Main Chat UI -->
        <Grid x:Name="ChatPanel" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Chat History -->
            <Border Grid.Row="0"
                    Background="#B2C7D9"
                    Margin="10,10,10,5"
                    CornerRadius="8"
                    BorderBrush="#D0D7DE"
                    BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0"
                          Margin="10"
                          ClipToBounds="True">
                        <StackPanel x:Name="ChatStackPanel"
                                    VerticalAlignment="Bottom"/>
                    </Grid>

                    <!-- Typing Indicator -->
                    <TextBlock x:Name="TypingIndicator"
                               Grid.Row="1"
                               Text="상대방이 입력 중..."
                               FontFamily="Malgun Gothic"
                               FontSize="11"
                               FontStyle="Italic"
                               Foreground="#666666"
                               Margin="15,5,15,10"
                               Visibility="Collapsed"/>
                </Grid>
            </Border>

            <!-- Message Input -->
            <Border Grid.Row="1"
                    Background="#FFFFFF"
                    Margin="10,5,10,10"
                    CornerRadius="8"
                    BorderBrush="#D0D7DE"
                    BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBox x:Name="MessageInputTextBox"
                             Grid.Row="0"
                             FontFamily="Malgun Gothic"
                             FontSize="14"
                             Foreground="#000000"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="15,10"
                             VerticalAlignment="Center"
                             Height="50"
                             MaxLength="280"
                             TextChanged="MessageInputTextBox_TextChanged"
                             KeyDown="MessageInputTextBox_KeyDown"/>

                    <TextBlock x:Name="CharCountTextBlock"
                               Grid.Row="1"
                               Text="0/280"
                               FontSize="10"
                               Foreground="#888888"
                               HorizontalAlignment="Right"
                               Margin="0,0,10,5"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
